import { MapService } from '../map.service';
import { Component, OnInit, OnChanges, SimpleChanges } from '@angular/core';
import { tileLayer, latLng, marker, Icon, IconOptions, Map, DivIcon } from 'leaflet';
import * as L from 'leaflet';
import 'leaflet.markercluster'

@Component({
  selector: 'app-map',
  templateUrl: './map.component.html',
  styleUrls: ['./map.component.scss']
})
export class MapComponent implements OnInit, OnChanges {

  constructor(private mapService: MapService) { }

  map: any;
  polyline: any;
  id: any
  chargingStation: any

  ngOnInit(): void {
    this.mapService.getChargingStations().subscribe(resp => {
      var locations = resp;
      var newIcon = L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.0.3/dist/images/marker-icon.png',
        iconSize: [20, 30],
      });

      var markers = L.markerClusterGroup()

      // Edit the marker
      // {
      //   iconCreateFunction: function (cluster) {
      //     return L.divIcon({ html: '<div class="leaflet-marker" >' + cluster.getChildCount() + '</div>' })
      //   }
      // }

      for (var i = 0; i < locations.length; i++) {
        // let marker = L.marker([locations[i].Latitude, locations[i].Longitude], { icon: newIcon })
        let m = L.marker([locations[i].Latitude, locations[i].Longitude], { icon: newIcon })
          .bindTooltip(locations[i].Name + '</br> ' + locations[i].ConnectorType)
        markers.addLayer(m).addTo(this.map);
      }
    })
    this.initMap();
    this.scrollToStation();
  }

  scrollToStation() {
    this.mapService.getchargingStation(1).subscribe(resp => {
      this.chargingStation = resp;
    })
  }

  initMap() {
    this.map = L.map('map', {
      center: [54.00, -2.0],
      zoom: 6
    });

    const key = 'pk.705dec6f3f73da4d251b9a4bd66faa89'

    let tiles = tileLayer(`https://{s}-tiles.locationiq.com/v2/obk/r/{z}/{x}/{y}.png?key=${key}`, {
      maxZoom: 18,
      minZoom: 3,
      attribution: '...'
    });


    this.polyline = L.polyline(
      [{ "lat": 53.95476, "lng": -2.09599 }, { "lat": 53.95855, "lng": -2.07476 }, { "lat": 53.95878, "lng": -2.06941 }, { "lat": 53.96015, "lng": -2.06383 }, { "lat": 53.96291, "lng": -2.05734 }, { "lat": 53.96457, "lng": -2.05194 }, { "lat": 53.96669, "lng": -2.04305 }, { "lat": 53.96621, "lng": -2.04277 }, { "lat": 53.96591, "lng": -2.0432 }, { "lat": 53.96277, "lng": -2.0431 }, { "lat": 53.95874, "lng": -2.04272 }, { "lat": 53.95657, "lng": -2.04158 }, { "lat": 53.95437, "lng": -2.03917 }, { "lat": 53.95335, "lng": -2.03739 }, { "lat": 53.95093, "lng": -2.03169 }, { "lat": 53.95082, "lng": -2.0313 }, { "lat": 53.94626, "lng": -2.02245 }, { "lat": 53.94381, "lng": -2.01918 }, { "lat": 53.94115, "lng": -2.01661 }, { "lat": 53.93772, "lng": -2.01317 }, { "lat": 53.93535, "lng": -2.01249 }, { "lat": 53.93039, "lng": -2.00688 }, { "lat": 53.92395, "lng": -2.00152 }, { "lat": 53.92147, "lng": -1.99863 }, { "lat": 53.9194, "lng": -1.99745 }, { "lat": 53.91717, "lng": -1.99806 }, { "lat": 53.91597, "lng": -1.99892 }, { "lat": 53.91497, "lng": -1.99891 }, { "lat": 53.91377, "lng": -1.99866 }, { "lat": 53.91261, "lng": -1.99684 }, { "lat": 53.91026, "lng": -1.98974 }, { "lat": 53.90785, "lng": -1.98596 }, { "lat": 53.90695, "lng": -1.98489 }, { "lat": 53.90658, "lng": -1.98335 }, { "lat": 53.90561, "lng": -1.97718 }, { "lat": 53.90328, "lng": -1.96712 }, { "lat": 53.90284, "lng": -1.95524 }, { "lat": 53.9015, "lng": -1.94435 }, { "lat": 53.9002, "lng": -1.94102 }, { "lat": 53.8979, "lng": -1.93651 }, { "lat": 53.89512, "lng": -1.93252 }, { "lat": 53.88983, "lng": -1.92764 }, { "lat": 53.88708, "lng": -1.92355 }, { "lat": 53.88534, "lng": -1.91658 }, { "lat": 53.88404, "lng": -1.91246 }, { "lat": 53.88121, "lng": -1.90873 }, { "lat": 53.87906, "lng": -1.9074 }, { "lat": 53.876, "lng": -1.90653 }, { "lat": 53.87483, "lng": -1.90388 }, { "lat": 53.87394, "lng": -1.89744 }, { "lat": 53.87359, "lng": -1.89602 }, { "lat": 53.87296, "lng": -1.89559 }, { "lat": 53.87198, "lng": -1.8929 }, { "lat": 53.8715, "lng": -1.88895 }, { "lat": 53.87073, "lng": -1.88293 }, { "lat": 53.86929, "lng": -1.87871 }, { "lat": 53.86759, "lng": -1.87587 }, { "lat": 53.86469, "lng": -1.86613 }, { "lat": 53.86277, "lng": -1.8567 }, { "lat": 53.86247, "lng": -1.85471 }, { "lat": 53.8606, "lng": -1.84805 }, { "lat": 53.85913, "lng": -1.8452 }, { "lat": 53.8567, "lng": -1.84212 }, { "lat": 53.85405, "lng": -1.8402 }, { "lat": 53.85145, "lng": -1.83924 }, { "lat": 53.84944, "lng": -1.83762 }, { "lat": 53.84841, "lng": -1.83498 }, { "lat": 53.84773, "lng": -1.83153 }, { "lat": 53.84553, "lng": -1.82888 }, { "lat": 53.8425, "lng": -1.82676 }, { "lat": 53.84021, "lng": -1.82453 }, { "lat": 53.83884, "lng": -1.82182 }, { "lat": 53.83704, "lng": -1.81985 }, { "lat": 53.83389, "lng": -1.81714 }, { "lat": 53.8335, "lng": -1.8168 }, { "lat": 53.83332, "lng": -1.81809 }, { "lat": 53.83354, "lng": -1.82029 }, { "lat": 53.83343, "lng": -1.82099 }, { "lat": 53.83187, "lng": -1.82105 }, { "lat": 53.83045, "lng": -1.821 }, { "lat": 53.83045, "lng": -1.82098 }, { "lat": 53.83044, "lng": -1.82096 }, { "lat": 53.83043, "lng": -1.82094 }, { "lat": 53.8304, "lng": -1.82093 }, { "lat": 53.83036, "lng": -1.821 }, { "lat": 53.83011, "lng": -1.82103 }, { "lat": 53.82798, "lng": -1.82029 }, { "lat": 53.82714, "lng": -1.81987 }, { "lat": 53.82591, "lng": -1.81722 }, { "lat": 53.8264, "lng": -1.81168 }, { "lat": 53.82629, "lng": -1.80986 }, { "lat": 53.82557, "lng": -1.80864 }, { "lat": 53.82156, "lng": -1.80674 }, { "lat": 53.81478, "lng": -1.80061 }, { "lat": 53.81299, "lng": -1.79545 }, { "lat": 53.81141, "lng": -1.79338 }, { "lat": 53.80883, "lng": -1.79115 }, { "lat": 53.80715, "lng": -1.79007 }, { "lat": 53.80653, "lng": -1.78738 }, { "lat": 53.80591, "lng": -1.78467 }, { "lat": 53.80463, "lng": -1.77781 }, { "lat": 53.80291, "lng": -1.77475 }, { "lat": 53.80104, "lng": -1.77099 }, { "lat": 53.79907, "lng": -1.76541 }, { "lat": 53.79847, "lng": -1.76412 }, { "lat": 53.79845, "lng": -1.76406 }, { "lat": 53.79519, "lng": -1.7573 }, { "lat": 53.79467, "lng": -1.75641 }, { "lat": 53.79369, "lng": -1.75623 }, { "lat": 53.79247, "lng": -1.756 }, { "lat": 53.7914, "lng": -1.75551 }, { "lat": 53.79084, "lng": -1.75398 }, { "lat": 53.79047, "lng": -1.75417 }, { "lat": 53.78791, "lng": -1.75303 }, { "lat": 53.78613, "lng": -1.75344 }, { "lat": 53.78337, "lng": -1.75627 }, { "lat": 53.77998, "lng": -1.76027 }, { "lat": 53.77898, "lng": -1.76077 }, { "lat": 53.77744, "lng": -1.76047 }, { "lat": 53.77617, "lng": -1.76 }, { "lat": 53.77426, "lng": -1.76038 }, { "lat": 53.77215, "lng": -1.76076 }, { "lat": 53.77134, "lng": -1.76035 }, { "lat": 53.77097, "lng": -1.75892 }, { "lat": 53.76978, "lng": -1.75449 }, { "lat": 53.76956, "lng": -1.75143 }, { "lat": 53.7697, "lng": -1.75015 }, { "lat": 53.76672, "lng": -1.74768 }, { "lat": 53.76478, "lng": -1.74588 }, { "lat": 53.76035, "lng": -1.74369 }, { "lat": 53.75316, "lng": -1.74089 }, { "lat": 53.75031, "lng": -1.73904 }, { "lat": 53.74235, "lng": -1.73139 }, { "lat": 53.73867, "lng": -1.72723 }, { "lat": 53.73812, "lng": -1.72581 }, { "lat": 53.7403, "lng": -1.72283 }, { "lat": 53.74396, "lng": -1.71738 }, { "lat": 53.74571, "lng": -1.71113 }, { "lat": 53.7459, "lng": -1.70713 }, { "lat": 53.74545, "lng": -1.70318 }, { "lat": 53.7429, "lng": -1.6956 }, { "lat": 53.74139, "lng": -1.68886 }, { "lat": 53.74123, "lng": -1.68263 }, { "lat": 53.7425, "lng": -1.67373 }, { "lat": 53.74581, "lng": -1.65311 }, { "lat": 53.74763, "lng": -1.64116 }, { "lat": 53.74746, "lng": -1.63589 }, { "lat": 53.74656, "lng": -1.63199 }, { "lat": 53.74474, "lng": -1.62811 }, { "lat": 53.74314, "lng": -1.62615 }, { "lat": 53.73878, "lng": -1.62285 }, { "lat": 53.73649, "lng": -1.61993 }, { "lat": 53.73484, "lng": -1.61663 }, { "lat": 53.73272, "lng": -1.61076 }, { "lat": 53.73016, "lng": -1.60273 }, { "lat": 53.72971, "lng": -1.59747 }, { "lat": 53.7304, "lng": -1.59219 }, { "lat": 53.73289, "lng": -1.58327 }, { "lat": 53.73355, "lng": -1.57632 }, { "lat": 53.73348, "lng": -1.5667 }, { "lat": 53.73335, "lng": -1.55244 }, { "lat": 53.73365, "lng": -1.5416 }, { "lat": 53.73428, "lng": -1.53455 }, { "lat": 53.73369, "lng": -1.52531 }, { "lat": 53.73175, "lng": -1.51307 }, { "lat": 53.73199, "lng": -1.51173 }, { "lat": 53.73158, "lng": -1.51044 }, { "lat": 53.73055, "lng": -1.51004 }, { "lat": 53.72992, "lng": -1.51074 }, { "lat": 53.72636, "lng": -1.515 }, { "lat": 53.72394, "lng": -1.5188 }, { "lat": 53.71918, "lng": -1.52805 }, { "lat": 53.71483, "lng": -1.53675 }, { "lat": 53.71168, "lng": -1.54474 }, { "lat": 53.70937, "lng": -1.54845 }, { "lat": 53.70672, "lng": -1.55136 }, { "lat": 53.70276, "lng": -1.5544 }, { "lat": 53.69951, "lng": -1.55637 }, { "lat": 53.69604, "lng": -1.55735 }, { "lat": 53.69033, "lng": -1.55663 }, { "lat": 53.68259, "lng": -1.5547 }, { "lat": 53.67738, "lng": -1.55316 }, { "lat": 53.67449, "lng": -1.55129 }, { "lat": 53.67201, "lng": -1.54896 }, { "lat": 53.66934, "lng": -1.54506 }, { "lat": 53.66696, "lng": -1.54068 }, { "lat": 53.659, "lng": -1.53115 }, { "lat": 53.65675, "lng": -1.52895 }, { "lat": 53.65468, "lng": -1.52799 }, { "lat": 53.65249, "lng": -1.52797 }, { "lat": 53.6502, "lng": -1.5287 }, { "lat": 53.64493, "lng": -1.53187 }, { "lat": 53.64136, "lng": -1.53528 }, { "lat": 53.63751, "lng": -1.53887 }, { "lat": 53.63486, "lng": -1.53986 }, { "lat": 53.63262, "lng": -1.53986 }, { "lat": 53.62953, "lng": -1.54058 }, { "lat": 53.6268, "lng": -1.54243 }, { "lat": 53.6225, "lng": -1.54706 }, { "lat": 53.61877, "lng": -1.55029 }, { "lat": 53.61489, "lng": -1.55203 }, { "lat": 53.60971, "lng": -1.55239 }, { "lat": 53.60413, "lng": -1.55134 }, { "lat": 53.60038, "lng": -1.54899 }, { "lat": 53.59695, "lng": -1.54509 }, { "lat": 53.59248, "lng": -1.5391 }, { "lat": 53.59007, "lng": -1.53716 }, { "lat": 53.58712, "lng": -1.5358 }, { "lat": 53.58353, "lng": -1.53559 }, { "lat": 53.57993, "lng": -1.53724 }, { "lat": 53.5753, "lng": -1.5403 }, { "lat": 53.57247, "lng": -1.54105 }, { "lat": 53.56805, "lng": -1.54056 }, { "lat": 53.56304, "lng": -1.53759 }, { "lat": 53.55951, "lng": -1.53397 }, { "lat": 53.55687, "lng": -1.53033 }, { "lat": 53.5543, "lng": -1.52499 }, { "lat": 53.55161, "lng": -1.51894 }, { "lat": 53.54854, "lng": -1.51538 }, { "lat": 53.53769, "lng": -1.50641 }, { "lat": 53.53442, "lng": -1.50292 }, { "lat": 53.5324, "lng": -1.49985 }, { "lat": 53.52862, "lng": -1.49484 }, { "lat": 53.52452, "lng": -1.49055 }, { "lat": 53.52271, "lng": -1.4892 }, { "lat": 53.52047, "lng": -1.48838 }, { "lat": 53.51831, "lng": -1.48837 }, { "lat": 53.51634, "lng": -1.48902 }, { "lat": 53.51233, "lng": -1.4906 }, { "lat": 53.51065, "lng": -1.49039 }, { "lat": 53.50872, "lng": -1.48941 }, { "lat": 53.50527, "lng": -1.4856 }, { "lat": 53.50135, "lng": -1.48219 }, { "lat": 53.49876, "lng": -1.47887 }, { "lat": 53.49722, "lng": -1.47596 }, { "lat": 53.49761, "lng": -1.47423 }, { "lat": 53.49711, "lng": -1.47314 }, { "lat": 53.49605, "lng": -1.47482 }, { "lat": 53.49563, "lng": -1.47658 }, { "lat": 53.49504, "lng": -1.47815 }, { "lat": 53.49494, "lng": -1.48084 }, { "lat": 53.49389, "lng": -1.4838 }, { "lat": 53.48986, "lng": -1.48829 }, { "lat": 53.4875, "lng": -1.49253 }, { "lat": 53.48691, "lng": -1.49308 }, { "lat": 53.48683, "lng": -1.49446 }, { "lat": 53.48823, "lng": -1.50802 }, { "lat": 53.48832, "lng": -1.51175 }, { "lat": 53.48743, "lng": -1.51623 }, { "lat": 53.4855, "lng": -1.5241 }, { "lat": 53.48407, "lng": -1.53206 }, { "lat": 53.48485, "lng": -1.54061 }, { "lat": 53.48547, "lng": -1.54499 }, { "lat": 53.48592, "lng": -1.55046 }, { "lat": 53.48505, "lng": -1.55492 }, { "lat": 53.48266, "lng": -1.56028 }, { "lat": 53.48223, "lng": -1.561 }, { "lat": 53.48165, "lng": -1.561 }, { "lat": 53.48072, "lng": -1.56408 }, { "lat": 53.47834, "lng": -1.5663 }, { "lat": 53.47767, "lng": -1.56655 }, { "lat": 53.47734, "lng": -1.56612 }, { "lat": 53.47617, "lng": -1.56482 }, { "lat": 53.47491, "lng": -1.5643 }, { "lat": 53.47292, "lng": -1.56337 }, { "lat": 53.46987, "lng": -1.56246 }, { "lat": 53.46659, "lng": -1.55863 }, { "lat": 53.45916, "lng": -1.55408 }, { "lat": 53.45748, "lng": -1.55408 }, { "lat": 53.45522, "lng": -1.55473 }, { "lat": 53.4528, "lng": -1.55323 }, { "lat": 53.45203, "lng": -1.55246 }, { "lat": 53.4508, "lng": -1.55231 }, { "lat": 53.4476, "lng": -1.55272 }, { "lat": 53.4465, "lng": -1.5524 }, { "lat": 53.44316, "lng": -1.54829 }, { "lat": 53.44172, "lng": -1.54657 }, { "lat": 53.44121, "lng": -1.54413 }, { "lat": 53.44041, "lng": -1.53904 }, { "lat": 53.43939, "lng": -1.53833 }, { "lat": 53.43728, "lng": -1.53963 }, { "lat": 53.43581, "lng": -1.53837 }, { "lat": 53.43317, "lng": -1.53507 }, { "lat": 53.43255, "lng": -1.53406 }, { "lat": 53.43204, "lng": -1.53335 }, { "lat": 53.43167, "lng": -1.53401 }, { "lat": 53.43104, "lng": -1.53507 }, { "lat": 53.43105, "lng": -1.53527 }, { "lat": 53.43183, "lng": -1.5369 }, { "lat": 53.43176, "lng": -1.53715 }, { "lat": 53.43178, "lng": -1.53752 }, { "lat": 53.43233, "lng": -1.53832 }, { "lat": 53.43275, "lng": -1.53992 }, { "lat": 53.43232, "lng": -1.54153 }, { "lat": 53.43179, "lng": -1.54198 }, { "lat": 53.43113, "lng": -1.54167 }, { "lat": 53.42964, "lng": -1.53977 }, { "lat": 53.42831, "lng": -1.5389 }, { "lat": 53.42814, "lng": -1.53819 }, { "lat": 53.42704, "lng": -1.53778 }, { "lat": 53.42484, "lng": -1.53888 }, { "lat": 53.42381, "lng": -1.53879 }, { "lat": 53.42382, "lng": -1.53991 }, { "lat": 53.42351, "lng": -1.5407 }, { "lat": 53.42322, "lng": -1.54058 }, { "lat": 53.42283, "lng": -1.54071 }, { "lat": 53.42262, "lng": -1.54073 }])
    this.map.addLayer(this.polyline);

    tiles.addTo(this.map);
  }

  ngOnChanges(changes: SimpleChanges): void {


  }


}
